<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pick Your Power â€” Pixel Anime Customizer</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#040417; --panel:rgba(255,255,255,0.03); --accent:#ffd88a; --muted:#9fb5d6;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Roboto,Arial;color:#eaf6ff;}
  #app{position:relative;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;}
  canvas{display:block; image-rendering:pixelated; background:transparent;}
  /* Menu overlay */
  .menu{
    position:absolute; left:50%; top:38%; transform:translate(-50%,-50%); text-align:center; z-index:40;
    pointer-events:auto;
  }
  .title{
    font-family:'Press Start 2P',monospace; color:var(--accent); font-size:36px; letter-spacing:2px;
    text-shadow:0 10px 30px rgba(0,0,0,0.7);
  }
  .prompt{
    margin-top:16px; font-family:'Press Start 2P',monospace; color:var(--muted); font-size:12px;
  }
  /* flash */
  .flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:80}
  /* Customizer panel */
  .panel{
    position:absolute; right:28px; top:50%; transform:translateY(-50%); width:420px; padding:16px; border-radius:12px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:0 12px 40px rgba(0,0,0,0.6); z-index:50; display:none;
    backdrop-filter: blur(6px);
  }
  .panel.visible{display:block}
  .preview{width:240px;height:360px;background:linear-gradient(180deg,#081226,#021223);border-radius:10px;padding:12px;margin:6px auto;border:1px solid rgba(255,255,255,0.04)}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  select,input[type="color"],input[type="range"]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#eaf6ff}
  .btn{padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(180deg,#1b2b3a,#0f1a24);color:var(--accent);cursor:pointer}
  .small{font-size:13px;padding:6px 8px}
  .note{font-size:12px;color:var(--muted);margin-top:8px}
  /* responsive */
  @media (max-width:960px){
    .panel{position:fixed;left:12px;right:12px;top:auto;bottom:18px;transform:none;width:auto;}
    .title{font-size:20px}
  }
</style>
</head>
<body>
  <div id="app" aria-label="Pick Your Power">
    <canvas id="bg" width="960" height="540" style="width:100vw;height:100vh;position:absolute;left:0;top:0;"></canvas>

    <div class="menu" id="menu">
      <div class="title">PICK YOUR POWER!</div>
      <div class="prompt">PRESS ANYWHERE TO CONTINUE</div>
    </div>

    <div class="flash" id="flash"></div>

    <div class="panel" id="panel" role="dialog" aria-label="Character customizer">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
        <div style="font-weight:800">Character Customizer</div>
        <button id="closePanel" class="btn small">Close</button>
      </div>

      <div class="preview" aria-hidden="false">
        <!-- Preview canvas is intentionally small (pixelated) -->
        <canvas id="preview" width="64" height="96" style="image-rendering:pixelated;width:192px;height:288px;display:block;margin:0 auto;"></canvas>
      </div>

      <div class="row"><label style="width:100px">Start</label>
        <select id="startState">
          <option value="pantsOnly">Pants only (bald)</option>
          <option value="fullDefault">Full default (clothed)</option>
        </select>
      </div>

      <div class="row"><label style="width:100px">Skin</label><input id="skinColor" type="color" value="#ffd7c4"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:6px">Hair</div>
      <div class="row"><label style="width:100px">Style</label>
        <select id="hairStyle">
          <option value="none">None (bald)</option>
          <option value="short">Short</option>
          <option value="spiky">Spiky</option>
          <option value="long">Long</option>
          <option value="ponytail">Ponytail</option>
        </select>
      </div>
      <div class="row"><label style="width:100px">Color</label><input id="hairColor" type="color" value="#222222"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:6px">Face</div>
      <div class="row"><label style="width:100px">Eyes</label>
        <select id="eyesStyle">
          <option value="none">None (hidden)</option>
          <option value="animeRound">Anime Round</option>
          <option value="animeSharp">Sharp</option>
          <option value="pixel">Pixel</option>
        </select>
      </div>
      <div class="row"><label style="width:100px">Eye Color</label><input id="eyesColor" type="color" value="#1b2b3a"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:6px">Outfit</div>
      <div class="row"><label style="width:100px">Pants</label>
        <select id="pantsStyle">
          <option value="simple">Simple</option>
          <option value="shorts">Shorts</option>
          <option value="baggy">Baggy</option>
        </select>
      </div>
      <div class="row"><label style="width:100px">Pants Color</label><input id="pantsColor" type="color" value="#2b4b7a"></div>
      <div class="row"><label style="width:100px">Height</label><input id="height" type="range" min="0.85" max="1.25" step="0.01" value="1"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:6px">Accessories</div>
      <div class="row"><label style="width:100px">Accessory</label>
        <select id="accessory">
          <option value="none">None</option>
          <option value="glasses">Glasses</option>
          <option value="scarf">Scarf</option>
          <option value="mask">Mask</option>
          <option value="helmet">Helmet</option>
        </select>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;">
        <button id="randomize" class="btn small">Randomize</button>
        <button id="reset" class="btn small" style="background:#203040">Reset</button>
        <button id="export" class="btn small" style="margin-left:auto">Export</button>
      </div>

      <div class="note">Preview is 2D pixel anime. Choosing "Pants only" starts the character bald with only pants displayed.</div>
    </div>
  </div>

<script>
/* Single-file: pixel anime preview, menu, flash to panel.
   - preview canvas is tiny 64x96 (true pixel art). CSS scales it up.
   - menu visible initially: Pick Your Power! + press anywhere.
   - pressing hides menu with bright flash then shows customizer.
   - initial state "pantsOnly" draws pants + bald head.
*/

/* ---------- Canvas background (subtle animated starfield) ---------- */
const bg = document.getElementById('bg');
const bgCtx = bg.getContext('2d');
let lastFitW = 0, lastFitH = 0;
function fitBg(){
  const w = window.innerWidth;
  const h = window.innerHeight;
  bg.width = Math.max(640, Math.round(w));
  bg.height = Math.max(360, Math.round(h));
  bg.style.width = '100vw';
  bg.style.height = '100vh';
  bgCtx.imageSmoothingEnabled = true;
  lastFitW = bg.width; lastFitH = bg.height;
}
window.addEventListener('resize', fitBg);
fitBg();

/* subtle moving background gradient + stars */
const stars = Array.from({length:120}, ()=>({ x: Math.random(), y: Math.random(), r: Math.random()*1.6+0.3, phase: Math.random()*Math.PI*2 }));
let t0 = performance.now();
function bgLoop(now){
  const t = (now - t0)/1000;
  const w = bg.width, h = bg.height;
  // gradient
  const g = bgCtx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,'#020218'); g.addColorStop(1,'#000814');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,w,h);
  // nebula glow
  const gx = w*0.28 + Math.sin(t*0.4)*80;
  const gy = h*0.3 + Math.cos(t*0.3)*48;
  const grad = bgCtx.createRadialGradient(gx,gy,0,gx,gy,Math.min(w,h)*0.5);
  grad.addColorStop(0,'rgba(120,160,255,0.06)'); grad.addColorStop(1,'rgba(0,0,0,0)');
  bgCtx.fillStyle = grad; bgCtx.fillRect(0,0,w,h);
  // stars
  for(const s of stars){
    const x = Math.floor(s.x * w + Math.sin(t*0.8 + s.phase)*6);
    const y = Math.floor(s.y * h + Math.cos(t*0.6 + s.phase)*6);
    bgCtx.fillStyle = 'rgba(255,255,255,0.85)';
    bgCtx.fillRect(x, y, Math.max(1, Math.round(s.r)), Math.max(1, Math.round(s.r)));
  }
  requestAnimationFrame(bgLoop);
}
requestAnimationFrame(bgLoop);

/* ---------- Menu -> Flash -> Panel ---------- */
const menu = document.getElementById('menu');
const flash = document.getElementById('flash');
const panel = document.getElementById('panel');

function openCustomizerWithFlash(){
  // flash white quickly
  flash.style.transition = 'none';
  flash.style.opacity = '1';
  requestAnimationFrame(()=> {
    flash.style.transition = 'opacity 480ms cubic-bezier(.2,.9,0,1)';
    flash.style.opacity = '0';
  });
  setTimeout(()=> {
    menu.style.display = 'none';
    panel.classList.add('visible');
  }, 160);
}
function onStart(){
  openCustomizerWithFlash();
  window.removeEventListener('pointerdown', onStart);
}
window.addEventListener('pointerdown', onStart, {passive:true});
window.addEventListener('touchstart', onStart, {passive:true});

/* ---------- Preview (64x96 pixel canvas) ---------- */
const preview = document.getElementById('preview');
const pctx = preview.getContext('2d');
pctx.imageSmoothingEnabled = false;
const PW = preview.width; const PH = preview.height;

/* UI elements */
const startStateEl = document.getElementById('startState');
const skinColorEl = document.getElementById('skinColor');
const hairStyleEl = document.getElementById('hairStyle');
const hairColorEl = document.getElementById('hairColor');
const eyesStyleEl = document.getElementById('eyesStyle');
const eyesColorEl = document.getElementById('eyesColor');
const pantsStyleEl = document.getElementById('pantsStyle');
const pantsColorEl = document.getElementById('pantsColor');
const heightEl = document.getElementById('height');
const accessoryEl = document.getElementById('accessory');
const randomizeBtn = document.getElementById('randomize');
const resetBtn = document.getElementById('reset');
const exportBtn = document.getElementById('export');
const closePanel = document.getElementById('closePanel');

/* character model state */
const model = {
  startState: startStateEl.value,
  skin: skinColorEl.value,
  hairStyle: hairStyleEl.value,
  hairColor: hairColorEl.value,
  eyesStyle: eyesStyleEl.value,
  eyesColor: eyesColorEl.value,
  pantsStyle: pantsStyleEl.value,
  pantsColor: pantsColorEl.value,
  height: parseFloat(heightEl.value),
  accessory: accessoryEl.value
};

/* utility helpers */
function lerp(a,b,t){ return a + (b-a) * t; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
function shade(hex, pct){
  const f = hex.replace('#','');
  const R = parseInt(f.substring(0,2),16);
  const G = parseInt(f.substring(2,4),16);
  const B = parseInt(f.substring(4,6),16);
  const t = pct/100;
  const newR = Math.round(R + ((t>0?255:0) - R) * Math.abs(t));
  const newG = Math.round(G + ((t>0?255:0) - G) * Math.abs(t));
  const newB = Math.round(B + ((t>0?255:0) - B) * Math.abs(t));
  return `rgb(${newR},${newG},${newB})`;
}

/* draw pixel anime character (simple, clean, 2D anime style) */
function drawPreview(){
  // clear
  pctx.clearRect(0,0,PW,PH);
  // backdrop
  pctx.fillStyle = '#071428';
  pctx.fillRect(0,0,PW,PH);

  const cx = Math.floor(PW/2);
  const floorY = PH - 12;
  const heightScale = model.height;

  // proportions in pixels
  const bodyH = Math.max(28, Math.round(36 * heightScale));
  const bodyW = Math.max(14, Math.round(20 * heightScale));
  const headW = Math.round(20 * heightScale);
  const headH = Math.round(16 * heightScale);

  // shadow
  pctx.fillStyle = 'rgba(0,0,0,0.35)';
  pctx.fillRect(cx-12, floorY-4, 24, 5);

  // pants (always present)
  const pantsTop = floorY - 8 - Math.round(bodyH*0.36);
  pctx.fillStyle = model.pantsColor;
  pctx.fillRect(cx - Math.round(bodyW/2), pantsTop, bodyW, Math.round(bodyH*0.36));

  // legs
  pctx.fillStyle = shade(model.pantsColor, -18);
  pctx.fillRect(cx - Math.round(bodyW/2), pantsTop + Math.round(bodyH*0.36), Math.round(bodyW*0.42), Math.round(bodyH*0.44));
  pctx.fillRect(cx + Math.round(bodyW*0.02), pantsTop + Math.round(bodyH*0.36), Math.round(bodyW*0.42), Math.round(bodyH*0.44));

  // torso only if startState != 'pantsOnly' (initial mode)
  if(model.startState !== 'pantsOnly'){
    pctx.fillStyle = model.skin;
    pctx.fillRect(cx - Math.round(bodyW/2), pantsTop - Math.round(bodyH*0.76), bodyW, Math.round(bodyH*0.76));
  }

  // head (always drawn)
  const headY = pantsTop - Math.round(bodyH*0.76) - headH - 2;
  pctx.fillStyle = model.skin;
  pctx.fillRect(cx - Math.round(headW/2), headY, headW, headH);

  // bald highlight if no hair
  if(model.hairStyle === 'none' || model.startState === 'pantsOnly'){
    pctx.fillStyle = 'rgba(255,255,255,0.12)';
    pctx.fillRect(cx - 4, headY + 3, 8, 3);
  }

  // hair (pixel anime shapes)
  if(model.hairStyle !== 'none' && model.startState !== 'pantsOnly'){
    pctx.fillStyle = model.hairColor;
    if(model.hairStyle === 'short'){
      pctx.fillRect(cx - Math.round(headW/2), headY - 2, headW, 7);
    } else if(model.hairStyle === 'spiky'){
      pctx.fillRect(cx - 9, headY - 6, 6, 8);
      pctx.fillRect(cx - 1, headY - 10, 6, 10);
      pctx.fillRect(cx + 7, headY - 6, 6, 8);
    } else if(model.hairStyle === 'long'){
      pctx.fillRect(cx - Math.round(headW/2), headY - 2, headW, 8);
      pctx.fillRect(cx - 8, headY + headH - 2, 16, 22 * heightScale);
    } else if(model.hairStyle === 'ponytail'){
      pctx.fillRect(cx - Math.round(headW/2), headY - 2, headW, 8);
      pctx.fillRect(cx + Math.round(headW/2)-4, headY + 6, 6, 18);
    }
  }

  // eyes (if any)
  if(model.eyesStyle !== 'none' && model.startState !== 'pantsOnly'){
    pctx.fillStyle = model.eyesColor;
    if(model.eyesStyle === 'animeRound'){
      pctx.fillRect(cx - 6, headY + 4, 4, 4);
      pctx.fillRect(cx + 2, headY + 4, 4, 4);
      pctx.fillStyle = '#fff'; pctx.fillRect(cx - 5, headY + 5, 1, 1); pctx.fillRect(cx + 3, headY + 5, 1, 1);
    } else if(model.eyesStyle === 'animeSharp'){
      pctx.fillRect(cx - 7, headY + 6, 10, 2);
      pctx.fillRect(cx + 0, headY + 6, 10, 2);
    } else if(model.eyesStyle === 'pixel'){
      pctx.fillRect(cx - 8, headY + 3, 3, 3);
      pctx.fillRect(cx - 4, headY + 5, 3, 3);
      pctx.fillRect(cx + 5, headY + 3, 3, 3);
      pctx.fillRect(cx + 1, headY + 5, 3, 3);
    }
  }

  // mouth
  pctx.fillStyle = 'rgba(0,0,0,0.6)';
  pctx.fillRect(cx - 3, headY + headH - 4, 6, 1);

  // accessory
  drawAccessoryPreview(cx, headY, headW, headH, model.accessory);

  // small outline (crisp)
  pctx.strokeStyle = 'rgba(0,0,0,0.25)';
  pctx.strokeRect(cx - Math.round(headW/2), headY, headW, headH);
}

/* accessory preview for small pixel art */
function drawAccessoryPreview(cx, headY, headW, headH, acc){
  if(acc === 'glasses'){
    pctx.strokeStyle = '#000'; pctx.lineWidth = 1;
    pctx.strokeRect(cx - 9, headY + 4, 5, 4);
    pctx.strokeRect(cx + 4, headY + 4, 5, 4);
    pctx.beginPath(); pctx.moveTo(cx - 4, headY + 6); pctx.lineTo(cx + 4, headY + 6); pctx.stroke();
  } else if(acc === 'mask'){
    pctx.fillStyle = '#222'; pctx.fillRect(cx - 10, headY + 10, 20, 4);
  } else if(acc === 'scarf'){
    pctx.fillStyle = '#b354ff'; pctx.fillRect(cx - 14, headY + headH + 2, 28, 5);
  } else if(acc === 'helmet'){
    pctx.fillStyle = '#444'; pctx.fillRect(cx - Math.round(headW/2), headY - 2, headW, 8);
  }
}

/* ---------- UI wiring ---------- */
function pullUI(){
  model.startState = startStateEl.value;
  model.skin = skinColorEl.value;
  model.hairStyle = hairStyleEl.value;
  model.hairColor = hairColorEl.value;
  model.eyesStyle = eyesStyleEl.value;
  model.eyesColor = eyesColorEl.value;
  model.pantsStyle = pantsStyleEl.value;
  model.pantsColor = pantsColorEl.value;
  model.height = parseFloat(heightEl.value);
  model.accessory = accessoryEl.value;

  // if startState is pantsOnly, ensure hair & eyes hidden initially
  if(model.startState === 'pantsOnly'){
    model.hairStyle = 'none';
    hairStyleEl.value = 'none';
    model.eyesStyle = 'none';
    eyesStyleEl.value = 'none';
    eyesStyleEl.dispatchEvent(new Event('change'));
    hairStyleEl.dispatchEvent(new Event('change'));
  }
  drawPreview();
}

[startStateEl, skinColorEl, hairStyleEl, hairColorEl, eyesStyleEl, eyesColorEl, pantsStyleEl, pantsColorEl, heightEl, accessoryEl]
.forEach(el => el.addEventListener('input', pullUI));
[startStateEl, hairStyleEl, eyesStyleEl, pantsStyleEl, accessoryEl].forEach(el => el.addEventListener('change', pullUI));

randomizeBtn.addEventListener('click', ()=>{
  hairStyleEl.value = ['none','short','spiky','long','ponytail'][Math.floor(Math.random()*5)];
  hairColorEl.value = '#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  eyesStyleEl.value = ['none','animeRound','animeSharp','pixel'][Math.floor(Math.random()*4)];
  eyesColorEl.value = '#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  pantsColorEl.value = '#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  heightEl.value = (0.85 + Math.random()*0.4).toFixed(2);
  accessoryEl.value = ['none','glasses','scarf','mask','helmet'][Math.floor(Math.random()*5)];
  pullUI();
});
resetBtn.addEventListener('click', ()=>{
  startStateEl.value = 'pantsOnly';
  skinColorEl.value = '#ffd7c4';
  hairStyleEl.value = 'none';
  hairColorEl.value = '#222222';
  eyesStyleEl.value = 'none';
  eyesColorEl.value = '#1b2b3a';
  pantsStyleEl.value = 'simple';
  pantsColorEl.value = '#2b4b7a';
  heightEl.value = 1;
  accessoryEl.value = 'none';
  pullUI();
});
exportBtn.addEventListener('click', ()=>{
  const url = preview.toDataURL('image/png');
  const a = document.createElement('a'); a.href = url; a.download = 'pixel-character.png'; a.click();
});
closePanel.addEventListener('click', ()=> panel.classList.remove('visible'));

/* initial state: ensure pants-only start */
resetBtn.click();

/* expose preview update */
window._drawPreview = drawPreview;
window._model = model;

/* keep preview scalable crisp when CSS scales */
function ensurePreviewSharp(){
  // preview canvas is 64x96; CSS scales it. No extra handling needed as rendering is in integer pixels.
}
ensurePreviewSharp();
</script>
</body>
</html>
```
