<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Street Arena — Prototype</title>
<style>
  :root{--bg:#0f1724;--panel:#0b1220;--accent:#e11d48;--muted:#94a3b8;}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
  body{background:linear-gradient(180deg,#071026,#041022);display:flex;height:100vh;align-items:stretch;gap:18px;padding:18px;box-sizing:border-box;color:#f8fafc;}
  .panel{width:320px;padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 10px 40px rgba(2,6,23,.6);}
  h2{margin:4px 0 12px 0;font-size:18px;}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px;}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:10px;}
  input[type=color]{width:56px;height:36px;border-radius:8px;border:none;padding:0;cursor:pointer;}
  .preset-row{display:flex;gap:8px;flex-wrap:wrap;}
  button{background:var(--accent);border:none;color:white;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700;}
  .ability-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px;}
  .slot{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;text-align:center;font-weight:800;position:relative;height:64px;display:flex;align-items:center;justify-content:center;}
  .slot small{display:block;font-weight:600;color:var(--muted);font-size:12px;margin-top:6px;}
  .cool{position:absolute;left:8px;right:8px;bottom:10px;height:6px;background:rgba(0,0,0,0.3);border-radius:6px;overflow:hidden;}
  .cool > i{display:block;height:100%;background:linear-gradient(90deg,#ffb86b,#f97316);width:0%;}
  .hint{color:var(--muted);font-size:13px;margin-top:10px;}
  .scene-wrap{flex:1;display:flex;flex-direction:column;gap:8px;position:relative;}
  canvas{width:100%;height:calc(100vh - 56px);border-radius:12px;display:block;background:#0b1220;box-shadow:0 10px 40px rgba(2,6,23,.6);}
  .hud{display:flex;align-items:center;gap:12px;padding:6px;color:var(--muted);}
  .hpbar{height:18px;background:#0b1220;border-radius:8px;overflow:hidden;border:2px solid rgba(255,255,255,0.03);width:360px;}
  .hpbar > i{display:block;height:100%;background:linear-gradient(90deg,#ef4444,#f97316);width:100%;}
  .center-ui{position:absolute;left:50%;transform:translateX(-50%);top:14px;color:#f8fafc;font-weight:800;text-shadow:0 3px 20px rgba(0,0,0,0.6);}
  .ability-hint{margin-left:auto;color:var(--muted);font-size:13px;}
  .footer{color:var(--muted);font-size:13px;margin-top:10px;}
  .floating{position:fixed;left:0;top:0;pointer-events:none;font-family:monospace;}
  @media (max-width:900px){body{flex-direction:column;padding:12px;} .panel{width:100%;order:2} canvas{height:56vh}}
</style>
</head>
<body>
  <aside class="panel">
    <h2>Character Customizer</h2>
    <label>Body Color</label>
    <div class="row"><input id="bodyColor" type="color" value="#ff6b6b"><div style="flex:1"></div></div>
    <label>Hair Color</label>
    <div class="row"><input id="hairColor" type="color" value="#222222"><div style="flex:1"></div></div>
    <label>Accent / Outfit</label>
    <div class="row"><input id="accColor" type="color" value="#60a5fa"><div style="flex:1"></div></div>

    <div class="preset-row" style="margin-top:8px;">
      <button id="preset1">Raging Red</button>
      <button id="preset2">Cool Blue</button>
      <button id="preset3">Forest</button>
    </div>

    <h2 style="margin-top:14px">Abilities (1–4)</h2>
    <div class="ability-grid">
      <div class="slot" id="slot1">1<small>Fire Punch</small><div class="cool"><i id="c1"></i></div></div>
      <div class="slot" id="slot2">2<small>Rising Shock</small><div class="cool"><i id="c2"></i></div></div>
      <div class="slot" id="slot3">3<small>Flash Dash</small><div class="cool"><i id="c3"></i></div></div>
      <div class="slot" id="slot4">4<small>Focus Beam</small><div class="cool"><i id="c4"></i></div></div>
    </div>

    <div class="hint">Use A/D or ←/→ to move • W to jump • 1–4 to use abilities • R to reset dummies</div>
    <div class="footer" style="margin-top:12px;">
      <div style="display:flex;gap:8px"><button id="spawn">Spawn +4 Dummies</button><button id="reset" style="background:#0f1724;padding:8px;border:1px solid rgba(255,255,255,0.04);">Reset</button></div>
      <div style="margin-top:8px;color:var(--muted)">Drop-in your sprites where indicated to replace placeholders.</div>
    </div>
  </aside>

  <section class="scene-wrap">
    <div class="hud">
      <div style="display:flex;flex-direction:column;">
        <div style="font-weight:800">PLAYER</div>
        <div class="hpbar"><i id="hpFill" style="width:100%"></i></div>
      </div>
      <div style="flex:1"></div>
      <div class="ability-hint">Dummies: <span id="count">0</span></div>
    </div>

    <div class="center-ui">STREET ARENA — Prototype</div>
    <canvas id="stage"></canvas>
  </section>

  <div class="floating" id="floatroot"></div>

<script>
/* Street Fighter style 2D prototype — single file
   - 2D canvas sprites (placeholders)
   - side-on view, parallax backgrounds
   - character customizer (colors)
   - 4 ability slots mapped to keys 1-4
   - dummies spawn, take hits, have simple state machine
   - hits produce spark + screen shake + floating damage
*/

/* ---------- Setup canvas & sizes ---------- */
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d', {alpha:false});
function resize(){
  const w = Math.max(900, window.innerWidth - 380);
  const h = Math.max(420, window.innerHeight - 120);
  canvas.width = Math.floor(w * devicePixelRatio);
  canvas.height = Math.floor(h * devicePixelRatio);
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener('resize', resize);
resize();

/* ---------- Globals & assets (placeholders) ---------- */
const floatRoot = document.getElementById('floatroot');
let shake = {x:0,y:0,m:0};
const palette = {body:'#ff6b6b',hair:'#222',acc:'#60a5fa'};
const sprites = {}; // hooks to drop real sprite images
const font = '700 18px "Inter", system-ui, sans-serif';

/* ---------- Player & dummy models ---------- */
const player = {
  x: 180, y: 260, vx:0, vy:0, w:64, h:96,
  facing: 1, onGround: true, jumping: false,
  hp: 100, maxHp: 100,
  state: 'idle', anim:0, combo:0
};
const dummies = []; // {x,y,w,h,hp,state,anim,staggerTimer}

/* ---------- Input ---------- */
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if(['1','2','3','4'].includes(e.key)) useAbility(Number(e.key));
  if(e.key.toLowerCase() === 'r') resetArena();
});
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

/* ---------- UI elements for cooldown visuals ---------- */
const AB = {
  1: {name:'Fire Punch', cool:700, last: -9999},
  2: {name:'Rising Shock', cool:1400, last: -9999},
  3: {name:'Flash Dash', cool:1000, last: -9999},
  4: {name:'Focus Beam', cool:1800, last: -9999}
};
const cEls = {1:document.getElementById('c1'),2:document.getElementById('c2'),3:document.getElementById('c3'),4:document.getElementById('c4')};
function updateCooldowns(){
  const now = performance.now();
  for(let i=1;i<=4;i++){
    const a = AB[i];
    const rem = Math.max(0, a.last + a.cool - now);
    const pct = 1 - (rem / a.cool);
    cEls[i].style.width = (pct*100)+'%';
  }
  requestAnimationFrame(updateCooldowns);
}
requestAnimationFrame(updateCooldowns);

/* ---------- Utility helpers ---------- */
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function rand(min,max){ return min + Math.random()*(max-min); }
function pushShake(m=6){
  shake.m = Math.max(shake.m, m);
}

/* ---------- Floating text DOM ---------- */
function floatText(x,y,txt,color='#fff',ms=900){
  const el = document.createElement('div');
  el.textContent = txt; el.style.position='absolute'; el.style.left = (x)+'px'; el.style.top = (y)+'px';
  el.style.transform = 'translate(-50%,-50%)'; el.style.color = color; el.style.fontWeight = '900';
  el.style.pointerEvents = 'none'; el.style.transition = `transform ${ms}ms cubic-bezier(.2,.8,0,1), opacity ${ms}ms`;
  floatRoot.appendChild(el);
  requestAnimationFrame(()=> {
    el.style.transform = 'translate(-50%,-140%)'; el.style.opacity = '0';
  });
  setTimeout(()=> el.remove(), ms+40);
}

/* ---------- Spawn & reset ---------- */
function spawnDummyAt(x,y){
  const d = {x,y,w:56,h:86,hp:70,maxHp:70,state:'idle',anim:0,vel:{x:0,y:0},stun:0};
  dummies.push(d); updateCount();
}
function spawnMany(n=4){
  for(let i=0;i<n;i++){
    const x = 520 + rand(-140,140);
    const y = 260 + rand(-6,12);
    spawnDummyAt(x,y);
  }
}
function resetArena(){
  dummies.length = 0; spawnMany(6); player.hp = player.maxHp; player.x = 180; player.y = 260; player.vx = 0; player.vy = 0; updateCount();
}
document.getElementById('spawn').addEventListener('click', ()=>{ spawnMany(4); });
document.getElementById('reset').addEventListener('click', resetArena);

/* ---------- Customizer binding ---------- */
document.getElementById('bodyColor').addEventListener('input', e=>{ palette.body = e.target.value; });
document.getElementById('hairColor').addEventListener('input', e=>{ palette.hair = e.target.value; });
document.getElementById('accColor').addEventListener('input', e=>{ palette.acc = e.target.value; });
document.getElementById('preset1').addEventListener('click', ()=>{ palette.body='#ff6b6b'; palette.hair='#2d2b2b'; palette.acc='#ffb86b'; updateInputs();});
document.getElementById('preset2').addEventListener('click', ()=>{ palette.body='#60a5fa'; palette.hair='#0b1220'; palette.acc='#f97316'; updateInputs();});
document.getElementById('preset3').addEventListener('click', ()=>{ palette.body='#34d399'; palette.hair='#111827'; palette.acc='#ffcd4a'; updateInputs();});
function updateInputs(){
  document.getElementById('bodyColor').value = palette.body;
  document.getElementById('hairColor').value = palette.hair;
  document.getElementById('accColor').value = palette.acc;
}

/* ---------- Combat primitives (2D collision) ---------- */
function rectHit(ax,ay,aw,ah,bx,by,bw,bh){
  return !(ax+aw/2 < bx-bw/2 || ax-aw/2 > bx+bw/2 || ay+ah/2 < by-bh/2 || ay-ah/2 > by+bh/2);
}

/* ---------- Abilities ---------- */
function useAbility(slot){
  const now = performance.now();
  const ab = AB[slot];
  if(now < ab.last + ab.cool) { setStatus('On cooldown'); return; }
  ab.last = now;
  // cooldown visual will update automatically
  if(slot === 1){ // Fire Punch: short lunge punch
    const reach = 80; const dmg = 14;
    player.state = 'attack'; player.anim = 0;
    // check dummies in front
    for(const d of dummies){
      if(d.state === 'dead') continue;
      if(player.facing > 0){
        if(rectHit(player.x+reach, player.y, 140, 80, d.x, d.y, d.w, d.h)){
          hitDummy(d, dmg, 12);
        }
      } else {
        if(rectHit(player.x-reach, player.y, 140, 80, d.x, d.y, d.w, d.h)){
          hitDummy(d, dmg, -12);
        }
      }
    }
    pushShake(6);
    setStatus('Fire Punch');
  } else if(slot === 2){ // Rising Shock: vertical hop + hit
    const dmg = 18;
    player.vy = -8; player.jumping = true; player.state = 'attack';
    for(const d of dummies){
      if(d.state === 'dead') continue;
      if(Math.abs(d.x - player.x) < 90 && Math.abs(d.y - player.y) < 80){
        hitDummy(d, dmg, (d.x>player.x)?6:-6);
      }
    }
    pushShake(8); setStatus('Rising Shock');
  } else if(slot === 3){ // Flash Dash: quick dash that knocks back
    const dir = player.facing;
    const dash = 140;
    player.x += dir * dash;
    for(const d of dummies){
      if(d.state === 'dead') continue;
      if(rectHit(player.x + dir*40, player.y, 130, 90, d.x, d.y, d.w, d.h)){
        hitDummy(d, 10, dir*16);
      }
    }
    pushShake(5); setStatus('Flash Dash');
  } else if(slot === 4){ // Focus Beam: narrow long-range hit
    const dmg = 6;
    for(const d of dummies){
      if(d.state === 'dead') continue;
      const dx = d.x - player.x;
      const inFront = (player.facing>0 && dx>0) || (player.facing<0 && dx<0);
      if(inFront && Math.abs(d.y - player.y) < 80 && Math.abs(dx) < 420){
        hitDummy(d, dmg, (dx>0)?6:-6);
      }
    }
    pushShake(4); setStatus('Focus Beam');
  }
}

/* ---------- Hit and dummy logic ---------- */
function hitDummy(d, dmg, push){
  if(d.state === 'dead') return;
  d.hp -= dmg;
  d.stun = 0.35;
  d.state = 'hit';
  d.vel.x += push * 0.6;
  floatText(d.x, d.y - 40, `-${Math.floor(dmg)}`, '#ffd1d1');
  spawnSparks(d.x, d.y);
  if(d.hp <= 0){
    d.state = 'dead';
    d.deadAt = performance.now();
    spawnSparks(d.x, d.y, 18);
    pushShake(10);
  }
}

/* ---------- Visual effects: sparks ---------- */
const sparks = [];
function spawnSparks(x,y,count=10){
  for(let i=0;i<count;i++){
    sparks.push({x, y, vx:rand(-4,4), vy:rand(-6,-1), life:rand(400,900), t:0, col: `hsl(${rand(20,40)},90%,60%)`});
  }
}

/* ---------- draw helpers (Street Fighter style) ---------- */
function drawBackground(ctx, w, h){
  // simple parallax layers: distant stadium, mid crowd, foreground floor
  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,'#102037'); g.addColorStop(1,'#071226');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);
  // distant banners
  ctx.fillStyle = '#0b2133';
  ctx.fillRect(0, h*0.55, w, h*0.45);
  // crowd silhouette
  ctx.fillStyle = '#071826';
  for(let i=0;i<4;i++){
    ctx.fillRect(0, h*0.62 + i*6, w, 6);
  }
  // arena floor
  ctx.fillStyle = '#0b1220';
  ctx.fillRect(0, h*0.73, w, h*0.27);
  // ring line
  ctx.strokeStyle = '#2b3b4b'; ctx.lineWidth = 6; ctx.beginPath(); ctx.moveTo(80, h*0.72); ctx.lineTo(w-80, h*0.72); ctx.stroke();
}

/* ---------- draw player & dummies (placeholder painted sprites) ---------- */
function drawCharacter(ctx, x, y, w, h, facing, pal, state, t){
  ctx.save();
  ctx.translate(x, y);
  ctx.scale(facing, 1);

  // shadow
  ctx.fillStyle = 'rgba(0,0,0,0.25)';
  ctx.beginPath(); ctx.ellipse(0, h*0.48, w*0.6, h*0.13, 0, 0, Math.PI*2); ctx.fill();

  // torso (soft painted)
  ctx.fillStyle = pal.body;
  roundRect(ctx, -w*0.5, -h*0.5 + 12, w, h*0.6, 12);
  ctx.fill();

  // accent sash
  ctx.fillStyle = pal.acc;
  ctx.fillRect(-w*0.5, -h*0.5 + 18, w, 10);

  // head
  ctx.beginPath(); ctx.fillStyle = pal.body;
  ctx.ellipse(0, -h*0.42, w*0.36, w*0.36, 0, 0, Math.PI*2); ctx.fill();

  // hair
  ctx.fillStyle = pal.hair;
  ctx.beginPath(); ctx.moveTo(-w*0.36, -h*0.55); ctx.quadraticCurveTo(0, -h*0.75, w*0.36, -h*0.55); ctx.fill();

  // eyes
  ctx.fillStyle = '#0b1220'; ctx.fillRect(-10, -h*0.44, 6, 8); ctx.fillRect(4, -h*0.44, 6, 8);

  // rough highlight for punch animation
  if(state === 'attack'){
    ctx.fillStyle = 'rgba(255,200,120,0.18)';
    ctx.beginPath(); ctx.ellipse(w*0.28 + (Math.sin(t*0.04)*6), -h*0.18, 24, 14, 0, 0, Math.PI*2); ctx.fill();
  }

  ctx.restore();
}
function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

/* ---------- main loop ---------- */
let last = performance.now();
function loop(){
  const now = performance.now(); const dt = Math.min(0.032, (now - last)/1000); last = now;
  const cw = canvas.clientWidth; const ch = canvas.clientHeight;

  // update shake
  if(shake.m > 0){ shake.x = rand(-shake.m, shake.m); shake.y = rand(-shake.m, shake.m); shake.m *= 0.88; if(shake.m < 0.3) shake.m = 0; }
  else { shake.x = 0; shake.y = 0; }

  // physics: player movement
  const acc = 650;
  if(keys['a']||keys['arrowleft']){ player.vx = -220; player.facing = -1; player.state = 'run'; }
  else if(keys['d']||keys['arrowright']){ player.vx = 220; player.facing = 1; player.state = 'run'; }
  else { player.vx = 0; if(!player.jumping) player.state = 'idle'; }

  // jump
  if((keys['w'] || keys[' ']) && player.onGround){ player.vy = -520; player.onGround = false; player.jumping = true; }

  // integrate
  player.x += player.vx * dt;
  player.y += player.vy * dt;
  // gravity
  player.vy += 1600 * dt;
  if(player.y > 260){ player.y = 260; player.vy = 0; player.onGround = true; player.jumping = false; }

  // clamp player within stage
  player.x = clamp(player.x, 80, cw - 150);

  // update dummies
  for(const d of dummies){
    if(d.state !== 'dead'){
      d.x += d.vel.x * dt * 60;
      d.y += d.vel.y * dt * 60;
      // friction
      d.vel.x *= 0.9; d.vel.y *= 0.98;
      // small AI wander
      if(Math.random() < 0.008) d.vel.x += rand(-0.6,0.6);
      d.x = clamp(d.x, 300, cw - 120);
    } else {
      // dead linger then respawn
      if(now - d.deadAt > 1600){
        // respawn at right side
        const idx = dummies.indexOf(d);
        if(idx !== -1){ dummies.splice(idx,1); spawnDummyAt(cw - rand(160,260), 260); }
      }
    }
    if(d.stun > 0) d.stun = Math.max(0, d.stun - dt);
  }

  // sparks
  for(let i=sparks.length-1;i>=0;i--){
    const s = sparks[i]; s.t += dt*1000; s.x += s.vx * dt * 60; s.y += s.vy * dt * 60; s.vy += 0.1;
    if(s.t > s.life){ sparks.splice(i,1); }
  }

  // update UI hp bar
  const hpFill = document.getElementById('hpFill'); hpFill.style.width = Math.max(0, (player.hp/player.maxHp)*100) + '%';

  // draw
  ctx.save();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.translate(shake.x, shake.y);

  drawBackground(ctx, cw, ch);

  // floor line (depth cue)
  ctx.fillStyle = '#111827'; ctx.fillRect(0, ch*0.72+4, cw, ch*0.28);

  // draw dummies (back to front)
  dummies.sort((a,b)=>a.x - b.x);
  for(const d of dummies){
    // shadow
    ctx.save();
    drawCharacter(ctx, d.x, d.y, d.w, d.h, -1, {body:'#d1d9e6', hair:'#39404a', acc:'#b0bec5'}, d.state, now);
    // hp above
    ctx.fillStyle = '#111827'; ctx.fillRect(d.x-40, d.y-120, 80, 12);
    ctx.fillStyle = '#ef4444'; ctx.fillRect(d.x-40, d.y-120, 80*(d.hp/d.maxHp), 12);
    ctx.restore();
  }

  // beam visual if recent (for slot 4)
  if(performance.now() - AB[4].last < 260){
    ctx.save();
    ctx.globalAlpha = 0.12;
    const bx = player.x + player.facing * 60;
    ctx.fillStyle = '#88ffea';
    ctx.fillRect(bx, player.y - 40, player.facing*380, 80);
    ctx.restore();
  }

  // draw player (front)
  drawCharacter(ctx, player.x, player.y, player.w, player.h, player.facing, {body:palette.body, hair:palette.hair, acc:palette.acc}, player.state, now);

  // draw sparks
  for(const s of sparks){
    ctx.fillStyle = s.col; ctx.fillRect(s.x-2, s.y-2, 4, 4);
  }

  ctx.restore();

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- helper functions & initial spawn ---------- */
function updateCount(){ document.getElementById('count').textContent = dummies.length; }
function spawnInitial(){ resetArena(); }
spawnInitial();

/* ---------- UI status (small transient) ---------- */
const centerUI = document.querySelector('.center-ui');
let statusTimer = 0;
function setStatus(txt){
  centerUI.textContent = txt;
  statusTimer = performance.now() + 900;
  setTimeout(()=>{ if(performance.now() > statusTimer) centerUI.textContent = 'STREET ARENA — Prototype'; }, 900);
}

/* ---------- spawn hook for sparks & floating damage ---------- */
function spawnSparks(x,y,count=8){
  spawnSparks = spawnSparksInner; // rebind to actual function body (closure fix)
  spawnSparksInner(x,y,count);
}
function spawnSparksInner(x,y,count=8){
  for(let i=0;i<count;i++){
    sparks.push({x, y, vx:rand(-3,3), vy:rand(-6,-1), life:rand(300,900), t:0, col: `hsl(${rand(20,40)},90%,60%)`});
  }
}

/* ---------- initial dummy spawn implementation (uses cw) ---------- */
function spawnDummyAt(x,y){
  const d = {x,y,w:56,h:86,hp:70,maxHp:70,state:'idle',vel:{x:rand(-0.5,0.5),y:0},stun:0};
  dummies.push(d); updateCount();
}

/* ---------- small polish: ability slot clicks ---------- */
for(let i=1;i<=4;i++){
  document.getElementById('slot'+i).addEventListener('click', ()=> useAbility(i));
}

/* ---------- countdown UI for cooldown animation (already running) ---------- */
updateCooldowns();

/* expose for debugging */
window._player = player;
window._dummies = dummies;
window._spawn = spawnMany;
</script>
</body>
</html>
```
