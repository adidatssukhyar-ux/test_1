<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pick Your Power — Pixel Anime Customizer</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{--bg:#05071a;--panel:rgba(255,255,255,0.03);--accent:#ffd88a;--muted:#9fb5d6;}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Roboto,Arial;color:#eaf6ff;-webkit-font-smoothing:antialiased;}
  #app{display:flex;gap:18px;padding:18px;box-sizing:border-box;height:100vh;}
  .scene{flex:1;display:flex;align-items:center;justify-content:center;position:relative;border-radius:12px;overflow:hidden}
  canvas#bg{width:100%;height:100%;display:block;background:linear-gradient(180deg,#05112b,#020416);}
  .panel{width:420px;padding:18px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 8px 40px rgba(0,0,0,0.6);}
  h2{margin:4px 0 12px 0;font-size:16px;color:var(--accent)}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  select,input[type="color"],input[type="range"]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#eaf6ff}
  .preview-wrap{display:flex;align-items:center;justify-content:center;margin-bottom:12px}
  .preview{width:240px;height:360px;background:#071428;border-radius:8px;padding:12px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.04)}
  .btn{padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(180deg,#1b2b3a,#0f1a24);color:var(--accent);cursor:pointer;font-weight:700}
  .small{font-size:13px;padding:6px 8px}
  .note{font-size:12px;color:var(--muted);margin-top:10px}
  @media (max-width:980px){ #app{flex-direction:column} .panel{width:auto} .preview{width:190px;height:280px} }
</style>
</head>
<body>
  <div id="app">
    <div class="scene">
      <canvas id="bg"></canvas>
    </div>

    <aside class="panel" aria-label="Character customizer">
      <h2>Character Customizer</h2>

      <div class="preview-wrap">
        <div class="preview" id="previewWrap" aria-hidden="false">
          <canvas id="preview" width="96" height="144" style="image-rendering:pixelated;width:192px;height:288px;"></canvas>
        </div>
      </div>

      <div class="row"><label style="width:96px">Body Color</label><input id="bodyColor" type="color" value="#ffd7c4"></div>

      <div class="row"><label style="width:96px">Start With</label>
        <select id="startState">
          <option value="pantsOnly">Pants only (default)</option>
          <option value="fullDefault">Full default (clothed)</option>
        </select>
      </div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:8px">Hair</div>
      <div class="row"><label>Style</label>
        <select id="hairStyle">
          <option value="none">None (bald)</option>
          <option value="short">Short</option>
          <option value="spiky">Spiky</option>
          <option value="long">Long</option>
          <option value="ponytail">Ponytail</option>
        </select>
      </div>
      <div class="row"><label>Color</label><input id="hairColor" type="color" value="#222222"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:8px">Face</div>
      <div class="row"><label>Eyes</label>
        <select id="eyesStyle">
          <option value="none">None (hidden)</option>
          <option value="animeRound">Anime round</option>
          <option value="animeSlit">Sharp</option>
          <option value="pixel">Pixel eyes</option>
        </select>
      </div>
      <div class="row"><label>Color</label><input id="eyesColor" type="color" value="#1b2b3a"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:8px">Body / Outfit</div>
      <div class="row"><label>Pants</label>
        <select id="pantsStyle">
          <option value="simple">Simple pants</option>
          <option value="shorts">Shorts</option>
          <option value="baggy">Baggy</option>
        </select>
      </div>
      <div class="row"><label>Pants Color</label><input id="pantsColor" type="color" value="#2b4b7a"></div>
      <div class="row"><label>Height</label><input id="heightRange" type="range" min="0.85" max="1.3" step="0.01" value="1"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0;">

      <div style="font-weight:700;margin-bottom:8px">Accessories</div>
      <div class="row"><label>Accessory</label>
        <select id="accessory">
          <option value="none">None</option>
          <option value="glasses">Glasses</option>
          <option value="scarf">Scarf</option>
          <option value="mask">Mask</option>
          <option value="helmet">Helmet</option>
        </select>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px;">
        <button id="randomize" class="btn small">Randomize</button>
        <button id="reset" class="btn small" style="background:#203040">Reset</button>
        <button id="exportBtn" class="btn small" style="margin-left:auto">Export</button>
      </div>

      <div class="note">Character starts bald with only pants when "Pants only" is selected.</div>
    </aside>
  </div>

<script>
/* Single-file 2D pixel anime customizer
   - Preview canvas uses small pixel grid (96x144) scaled up for crisp pixel look.
   - Default startState "pantsOnly" => character begins bald with only pants shown.
   - Controls: body color, hair style & color, eyes style & color, pants style/color, height, accessory.
   - Live preview updates on change.
   - Simple star/space background retained but subtle; not required.
*/

/* ---------------- preview drawing setup ---------------- */
const preview = document.getElementById('preview');
const p = preview.getContext('2d');
preview.style.background = 'transparent';
p.imageSmoothingEnabled = false;

const BG_CANVAS = document.getElementById('bg');
const bg = BG_CANVAS.getContext('2d', {alpha:true});
let DPR = Math.min(window.devicePixelRatio || 1, 2);

/* size helper: preview internal pixels 96x144 (4:6) scaled for display via CSS */
const PRE_W = preview.width = 96;
const PRE_H = preview.height = 144;

/* UI elements */
const bodyColorEl = document.getElementById('bodyColor');
const startStateEl = document.getElementById('startState');
const hairStyleEl = document.getElementById('hairStyle');
const hairColorEl = document.getElementById('hairColor');
const eyesStyleEl = document.getElementById('eyesStyle');
const eyesColorEl = document.getElementById('eyesColor');
const pantsStyleEl = document.getElementById('pantsStyle');
const pantsColorEl = document.getElementById('pantsColor');
const heightRangeEl = document.getElementById('heightRange');
const accessoryEl = document.getElementById('accessory');
const randomizeBtn = document.getElementById('randomize');
const resetBtn = document.getElementById('reset');
const exportBtn = document.getElementById('exportBtn');

/* character state: default is bald with only pants (pantsOnly) */
const char = {
  startState: 'pantsOnly', // or fullDefault
  bodyColor: bodyColorEl.value,
  hairStyle: 'none',
  hairColor: hairColorEl.value,
  eyesStyle: 'none',
  eyesColor: eyesColorEl.value,
  pantsStyle: pantsStyleEl.value,
  pantsColor: pantsColorEl.value,
  height: parseFloat(heightRangeEl.value),
  accessory: 'none',
  scale: 2 // preview pixel scale (visual only)
};

/* helpers for drawing pixel art shapes */
function clearPreview(){
  p.clearRect(0,0,PRE_W,PRE_H);
  // fill faint background for contrast
  p.fillStyle = '#061428';
  p.fillRect(0,0,PRE_W,PRE_H);
}

/* small pixel-round rectangle */
function fillRect(ix,iy,w,h,color){
  p.fillStyle = color;
  p.fillRect(ix,iy,w,h);
}

/* draw 2D pixel anime character in blocky/pixel-art style.
   Layout coordinates are in preview pixel space (96x144).
*/
function drawCharacter(){
  clearPreview();
  // center baseline
  const cx = Math.floor(PRE_W/2);
  const floorY = PRE_H - 16;
  const heightScale = char.height;

  // basic proportions (pixel units)
  const bodyH = Math.round(40 * heightScale);
  const bodyW = Math.round(22 * heightScale);
  const headW = Math.round(24 * heightScale);
  const headH = Math.round(20 * heightScale);

  // draw shadow under feet
  p.fillStyle = 'rgba(0,0,0,0.35)';
  p.fillRect(cx-18, floorY-4, 36, 6);

  // pants only default: draw pants and legs
  // pants block
  const pantsTopY = floorY - Math.round(8 + bodyH*0.12);
  fillRect(cx - Math.round(bodyW/2), pantsTopY, bodyW, Math.round(bodyH*0.36), char.pantsColor);

  // legs below pants
  fillRect(cx - Math.round(bodyW/2), pantsTopY + Math.round(bodyH*0.36), Math.round(bodyW*0.4), Math.round(bodyH*0.36), shade(char.pantsColor, -18));
  fillRect(cx + Math.round(bodyW*0.02), pantsTopY + Math.round(bodyH*0.36), Math.round(bodyW*0.4), Math.round(bodyH*0.36), shade(char.pantsColor, -18));

  // torso (only draw if startState != pantsOnly OR if user later chooses a torso by CSS—initially pantsOnly hides torso)
  if(char.startState !== 'pantsOnly'){
    fillRect(cx - Math.round(bodyW/2), pantsTopY - Math.round(bodyH*0.76), bodyW, Math.round(bodyH*0.76), char.bodyColor);
  }

  // head (always draw head; if hairStyle is none show bald head)
  const headY = pantsTopY - Math.round(bodyH*0.76) - headH - 2;
  fillRect(cx - Math.round(headW/2), headY, headW, headH, char.bodyColor);

  // ears (small)
  fillRect(cx - Math.round(headW/2) - 2, headY + 6, 2, 4, shade(char.bodyColor, -12));
  fillRect(cx + Math.round(headW/2), headY + 6, 2, 4, shade(char.bodyColor, -12));

  // hair (only if hairStyle != 'none')
  if(char.hairStyle !== 'none'){
    p.fillStyle = char.hairColor;
    if(char.hairStyle === 'short'){
      fillRect(cx - Math.round(headW/2), headY - 2, headW, 8, char.hairColor); // fringe
    } else if(char.hairStyle === 'spiky'){
      // spikes: three triangles approximated as blocks
      fillRect(cx - Math.round(headW/2), headY - 2, 8, 10, char.hairColor);
      fillRect(cx - 2, headY - 8, 8, 12, char.hairColor);
      fillRect(cx + Math.round(headW/2)-6, headY - 2, 8, 10, char.hairColor);
    } else if(char.hairStyle === 'long'){
      fillRect(cx - Math.round(headW/2), headY - 2, headW, 8, char.hairColor); // top
      // long back
      fillRect(cx - Math.round(headW/2)+2, headY + headH - 2, headW - 4, 26 * heightScale, char.hairColor);
    } else if(char.hairStyle === 'ponytail' || char.hairStyle === 'ponytail'){
      fillRect(cx - Math.round(headW/2), headY - 2, headW, 8, char.hairColor); // top
      // pony tail to the side
      fillRect(cx + Math.round(headW/2)-6, headY + 6, 10, 22 * heightScale, char.hairColor);
    }
  } else {
    // bald highlight: small shine band
    fillRect(cx - 6, headY + 4, 12, 3, 'rgba(255,255,255,0.15)');
  }

  // eyes (only if eyesStyle != 'none')
  if(char.eyesStyle !== 'none'){
    p.fillStyle = char.eyesColor;
    if(char.eyesStyle === 'animeRound'){
      // two bigger eye blocks with light reflection
      fillRect(cx - 9, headY + 6, 6, 6, char.eyesColor);
      fillRect(cx + 3, headY + 6, 6, 6, char.eyesColor);
      // tiny white spark
      fillRect(cx - 7, headY + 7, 2, 2, '#fff');
      fillRect(cx + 5, headY + 7, 2, 2, '#fff');
    } else if(char.eyesStyle === 'animeSlit'){
      fillRect(cx - 11, headY + 9, 12, 2, char.eyesColor);
      fillRect(cx + 1, headY + 9, 12, 2, char.eyesColor);
    } else if(char.eyesStyle === 'pixel'){
      fillRect(cx - 12, headY + 6, 4, 4, char.eyesColor);
      fillRect(cx - 8, headY + 8, 4, 4, char.eyesColor);
      fillRect(cx + 8, headY + 6, 4, 4, char.eyesColor);
      fillRect(cx + 4, headY + 8, 4, 4, char.eyesColor);
    }
  }

  // mouth (small)
  fillRect(cx - 3, headY + headH - 6, 6, 2, shade('#000000', 40));

  // accessory
  drawAccessoryPreview(cx, headY, headW, headH, char.accessory);

  // outline for readability (thin)
  p.strokeStyle = 'rgba(0,0,0,0.25)';
  p.lineWidth = 1;
  // outline head
  p.strokeRect(cx - Math.round(headW/2), headY, headW, headH);
  // outline pants
  p.strokeRect(cx - Math.round(bodyW/2), pantsTopY, bodyW, Math.round(bodyH*0.36));

  // replicate small pixel grid aesthetic by ensuring integer coords (done)
}

/* accessory rendering for preview */
function drawAccessoryPreview(cx, headY, headW, headH, acc){
  if(acc === 'glasses'){
    p.strokeStyle = '#000';
    p.lineWidth = 1.2;
    p.strokeRect(cx - 11, headY + 6, 8, 6);
    p.strokeRect(cx + 3, headY + 6, 8, 6);
    p.beginPath(); p.moveTo(cx - 3, headY + 9); p.lineTo(cx + 3, headY + 9); p.stroke();
  } else if(acc === 'mask'){
    p.fillStyle = '#222';
    p.fillRect(cx - 12, headY + 12, 24, 6);
  } else if(acc === 'scarf'){
    p.fillStyle = '#b354ff';
    p.fillRect(cx - 18, headY + headH + 2, 36, 6);
  } else if(acc === 'helmet'){
    p.fillStyle = '#444';
    p.fillRect(cx - Math.round(headW/2), headY - 2, headW, 10);
  }
}

/* simple shade utility */
function shade(hex, pct){
  const f = hex.replace('#','');
  const R = parseInt(f.substring(0,2),16);
  const G = parseInt(f.substring(2,4),16);
  const B = parseInt(f.substring(4,6),16);
  const t = pct/100;
  const newR = Math.round(R + ((t>0?255:0) - R) * Math.abs(t));
  const newG = Math.round(G + ((t>0?255:0) - G) * Math.abs(t));
  const newB = Math.round(B + ((t>0?255:0) - B) * Math.abs(t));
  return `rgb(${newR},${newG},${newB})`;
}

/* ---------------- UI interactions ---------------- */
function applyUIToState(){
  char.bodyColor = bodyColorEl.value;
  char.startState = startStateEl.value;
  // if startState is pantsOnly, force hair & eyes none until user changes
  if(char.startState === 'pantsOnly'){
    char.hairStyle = 'none';
    hairStyleEl.value = 'none';
    char.eyesStyle = 'none';
    eyesStyleEl.value = 'none';
  } else {
    char.hairStyle = hairStyleEl.value;
    char.eyesStyle = eyesStyleEl.value;
  }
  char.hairColor = hairColorEl.value;
  char.eyesColor = eyesColorEl.value;
  char.pantsStyle = pantsStyleEl.value;
  char.pantsColor = pantsColorEl.value;
  char.height = parseFloat(heightRangeEl.value);
  char.accessory = accessoryEl.value;
  refreshPreview();
}

/* event listeners */
bodyColorEl.addEventListener('input', ()=>{ char.bodyColor = bodyColorEl.value; refreshPreview(); });
startStateEl.addEventListener('change', ()=>{
  char.startState = startStateEl.value;
  if(char.startState === 'pantsOnly'){
    // force bald & hide torso
    hairStyleEl.value = 'none'; hairColorEl.value = '#222222';
    eyesStyleEl.value = 'none'; eyesColorEl.value = '#111111';
    hairStyleEl.dispatchEvent(new Event('change'));
    eyesStyleEl.dispatchEvent(new Event('change'));
  }
  refreshPreview();
});
hairStyleEl.addEventListener('change', ()=>{ char.hairStyle = hairStyleEl.value; refreshPreview(); });
hairColorEl.addEventListener('input', ()=>{ char.hairColor = hairColorEl.value; refreshPreview(); });
eyesStyleEl.addEventListener('change', ()=>{ char.eyesStyle = eyesStyleEl.value; refreshPreview(); });
eyesColorEl.addEventListener('input', ()=>{ char.eyesColor = eyesColorEl.value; refreshPreview(); });
pantsStyleEl.addEventListener('change', ()=>{ char.pantsStyle = pantsStyleEl.value; refreshPreview(); });
pantsColorEl.addEventListener('input', ()=>{ char.pantsColor = pantsColorEl.value; refreshPreview(); });
heightRangeEl.addEventListener('input', ()=>{ char.height = parseFloat(heightRangeEl.value); refreshPreview(); });
accessoryEl.addEventListener('change', ()=>{ char.accessory = accessoryEl.value; refreshPreview(); });

randomizeBtn.addEventListener('click', ()=>{
  const hairOptions = ['none','short','spiky','long','ponytail'];
  const eyesOptions = ['none','animeRound','animeSlit','pixel'];
  hairStyleEl.value = hairOptions[Math.floor(Math.random() * hairOptions.length)];
  eyesStyleEl.value = eyesOptions[Math.floor(Math.random() * eyesOptions.length)];
  hairColorEl.value = '#' + Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  eyesColorEl.value = '#' + Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  pantsColorEl.value = '#' + Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0');
  heightRangeEl.value = (0.85 + Math.random()*0.45).toFixed(2);
  accessoryEl.value = ['none','glasses','scarf','mask','helmet'][Math.floor(Math.random()*5)];
  // if startState is pantsOnly, randomly keep hair none often
  if(startStateEl.value === 'pantsOnly' && Math.random() < 0.75) hairStyleEl.value = 'none';
  applyUIToState();
});

resetBtn.addEventListener('click', ()=>{
  bodyColorEl.value = '#ffd7c4';
  hairStyleEl.value = 'none';
  hairColorEl.value = '#222222';
  eyesStyleEl.value = 'none';
  eyesColorEl.value = '#111111';
  pantsStyleEl.value = 'simple';
  pantsColorEl.value = '#2b4b7a';
  heightRangeEl.value = 1;
  accessoryEl.value = 'none';
  startStateEl.value = 'pantsOnly';
  applyUIToState();
});

exportBtn.addEventListener('click', ()=>{
  // export preview as PNG
  const data = preview.toDataURL('image/png');
  const a = document.createElement('a'); a.href = data; a.download = 'character.png'; a.click();
});

/* refreshPreview reads char values and draws */
function refreshPreview(){
  // ensure char uses UI values
  char.bodyColor = bodyColorEl.value;
  char.hairColor = hairColorEl.value;
  char.eyesColor = eyesColorEl.value;
  char.pantsColor = pantsColorEl.value;
  char.pantsStyle = pantsStyleEl.value;
  char.height = parseFloat(heightRangeEl.value);
  char.accessory = accessoryEl.value;
  char.hairStyle = hairStyleEl.value;
  char.eyesStyle = eyesStyleEl.value;
  char.startState = startStateEl.value;

  // paint elements' colors into drawing logic
  // use char.bodyColor as head/skin
  // apply in drawing by temporarily swapping colors
  // store and set used colors
  const prev = { body: char.bodyColor, hair: char.hairColor, eyes: char.eyesColor, pants: char.pantsColor };
  // draw with these colors
  // ensure preview context uses integer coordinates
  drawCharacter();
}

/* initial state: pants only, bald */
resetBtn.click();

/* ---------------- small background starfield (subtle) ---------------- */
function fitBg(){
  const w = Math.max(640, Math.round(window.innerWidth * 0.9));
  const h = Math.max(360, Math.round(window.innerHeight * 0.9));
  BG_CANVAS.width = w * DPR; BG_CANVAS.height = h * DPR;
  BG_CANVAS.style.width = '100%'; BG_CANVAS.style.height = '100%';
  bg.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', fitBg);
fitBg();

// subtle animated star dots behind preview (no parallax heavy)
const starDots = Array.from({length:80}, ()=>({ x: Math.random(), y: Math.random(), r: Math.random()*1.8 + 0.3, phase: Math.random()*Math.PI*2 }));
let lastT = performance.now();
function bgLoop(now){
  const dt = Math.min((now - lastT)/1000, 0.04);
  lastT = now;
  // fade background gradient
  bg.clearRect(0,0,BG_CANVAS.width/DPR, BG_CANVAS.height/DPR);
  const w = BG_CANVAS.width/DPR, h = BG_CANVAS.height/DPR;
  const g = bg.createLinearGradient(0,0,0,h);
  g.addColorStop(0,'#051028'); g.addColorStop(1,'#020218'); bg.fillStyle = g; bg.fillRect(0,0,w,h);

  // moving nebula glow under center-left
  const gx = w*0.28 + Math.sin(now*0.0007)*40;
  const gy = h*0.32 + Math.cos(now*0.0009)*24;
  const grad = bg.createRadialGradient(gx,gy,0,gx,gy,Math.min(w,h)*0.5);
  grad.addColorStop(0,'rgba(140,180,255,0.06)'); grad.addColorStop(1,'rgba(0,0,0,0)');
  bg.fillStyle = grad; bg.fillRect(gx - w, gy - h, w*2, h*2);

  // stars
  for(const s of starDots){
    const x = s.x * w + Math.sin(now*0.0012 + s.phase) * 6;
    const y = s.y * h + Math.cos(now*0.0016 + s.phase) * 4;
    bg.fillStyle = 'rgba(255,255,255,0.85)';
    bg.beginPath(); bg.ellipse(x,y,s.r,s.r,0,0,Math.PI*2); bg.fill();
  }

  requestAnimationFrame(bgLoop);
}
requestAnimationFrame(bgLoop);

/* expose for debug */
window._char = char;
window._refresh = refreshPreview;
</script>
</body>
</html>
```
